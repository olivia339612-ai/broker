# 吊弦位置标记小车

本项目提供一个前后端一体的演示服务，用于通过 MQTT 与吊弦标记小车交互，完成参数下发、任务控制、跨距数据展示以及日志查看。

## 快速开始
1. 安装依赖：
   ```bash
   npm install
   ```
2. 启动服务：
   ```bash
   node src/server.js
   ```
   默认监听 `http://localhost:3000` 并使用内置 MQTT 服务器地址（`124.222.86.236:1883`）。如需调整可在 `src/server.js` 中修改。

   也可以在启动时通过环境变量覆盖：
   ```bash
   MQTT_HOST=127.0.0.1 MQTT_PORT=1883 MQTT_USER=user MQTT_PASSWORD=pass node src/server.js
   ```

## 主要功能
- **参数设置**：输入两端吊弦位置 `side`（cm）和跨内吊弦总数 `num`，仅在小车在线时允许锁定并通过 MQTT `data` 主题下发。
- **小车控制**：支持开始、暂停、继续、结束，指令发送到 `cmd` 主题。
- **任务数据**：接收 `task` 主题的跨距与测量结果，计算吊弦等间距并绘制形象坐标；未完成的下一跨以“测量中···”占位显示。
- **工作日志**：记录 MQTT 连接与指令、参数变更、跨度数据等关键信息，并在顶部提供“MQTT 连接”入口，点击可在独立弹窗中查看/修改连接配置。
- **实时状态**：展示车速、里程（DK 格式）、开机时长、已标记吊弦/跨数，并针对手机端做了居中与放大排版。
- **MQTT 配置**：通过“MQTT 连接”弹窗可动态切换服务器地址、端口、账号和订阅主题，保存后后台自动重连。

## 目录结构
- `src/server.js`：HTTP API、静态资源与简易 MQTT 客户端实现。
- `public/`：前端页面、样式与交互脚本。
- `README/`：原始需求与业务背景文档。

## 接口概览
- `GET /api/state`：获取在线状态、当前参数、控制状态、实时车况、任务与日志。
- `POST /api/parameters/lock`：锁定并下发参数，body `{ side, num }`。
- `POST /api/parameters/unlock`：解锁参数（需任务空闲）。
- `POST /api/control/{start|stop|continue|over}`：任务控制指令。

## 说明
- 参数与跨距的计算及 UI 逻辑均遵循 `README/` 下的需求文档。
- 前端轴刻度支持横向滚动，保证在手机端数字不被截断。
- MQTT 未连通时会在日志中提示，但不会阻塞本地 UI 体验。
